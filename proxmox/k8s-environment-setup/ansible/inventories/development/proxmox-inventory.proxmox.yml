---
plugin: community.general.proxmox

validate_certs: false  # only do this when you trust the network!
## set url value via environment variable PROXMOX_URL
#url: https://192.168.0.50:8006

## set user value via environment variable PROXMOX_USER
#user: terraform@pve

## set user value via environment variable PROXMOX_TOKEN_ID
#token_id: provider

## set token_secret value via environment variable TOKEN_SECRET
#token_secret:

want_facts: true

## filter out the host based on tags
filters:
  - proxmox_status == "running"
  - "proxmox_tags_parsed is defined and 'k8s' in proxmox_tags_parsed"
  - "'worker' or 'controlplane' in proxmox_tags_parsed"

## add new host groups(k8s_cp_hosts & k8s_worker_hosts) in inventory based on their tags
groups:
  k8s_cp_hosts: "'controlplane' in (proxmox_tags_parsed|list)"
  k8s_worker_hosts: "'worker' in (proxmox_tags_parsed|list)"

## include ansible_host so that ansible could connect to it
compose:
  ansible_host: proxmox_ipconfig0.ip | default(proxmox_net0.ip) | ansible.utils.ipaddr('address')

# to include proxmox servers host
#want_proxmox_nodes_ansible_host: true
